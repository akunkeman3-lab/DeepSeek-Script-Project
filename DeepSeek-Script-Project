--[[
    LusiGPT Dominator V17 - WEAPON MASTER EDITION
    Status: 
    [+] V16 CORE: Stable Teleport, Raid, Shop, ESP
    [+] NEW FARM: Select Weapon (Melee/Sword/Fruit/Gun) + Auto Equip
    [+] AUTO ATTACK: Fully Automated (No Manual Click Needed)
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "LusiGPT HUB - DOMINASI V17",
   LoadingTitle = "Mengasah Senjata Pilihan...",
   LoadingSubtitle = "By LusiGPT",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false 
})

-- ================= VARIABLE & SERVICES =================
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local Speed = 300
getgenv().AutoFarm = false
getgenv().PlayerESP = false
getgenv().FruitESP = false
getgenv().AutoRaid = false
getgenv().SelectWeapon = "Melee" -- Default Weapon

-- ================= FUNGSI EQUIP WEAPON (BARU) =================
local function EquipWeapon(wType)
    local char = LocalPlayer.Character
    local backpack = LocalPlayer.Backpack
    if not char then return end

    -- Cek jika senjata sudah dipegang
    local equipped = char:FindFirstChildOfClass("Tool")
    if equipped then
        if wType == "Melee" and equipped.ToolTip == "Melee" then return end
        if wType == "Sword" and equipped.ToolTip == "Sword" then return end
        if wType == "Gun" and equipped.ToolTip == "Gun" then return end
        if wType == "Fruit" and equipped.ToolTip == "Blox Fruit" then return end
    end

    -- Cari di Backpack dan Equip
    for _, tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") then
            if wType == "Melee" and tool.ToolTip == "Melee" then char.Humanoid:EquipTool(tool) break end
            if wType == "Sword" and tool.ToolTip == "Sword" then char.Humanoid:EquipTool(tool) break end
            if wType == "Gun" and tool.ToolTip == "Gun" then char.Humanoid:EquipTool(tool) break end
            if wType == "Fruit" and tool.ToolTip == "Blox Fruit" then char.Humanoid:EquipTool(tool) break end
        end
    end
end

-- ================= FUNGSI UTAMA (SAFE TWEEN V12) =================
local function SafeTween(targetCFrame)
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local hrp = char.HumanoidRootPart
        local dist = (hrp.Position - targetCFrame.Position).Magnitude
        local info = TweenInfo.new(dist/Speed, Enum.EasingStyle.Linear)
        local tween = TweenService:Create(hrp, info, {CFrame = targetCFrame})
        
        local noclip
        noclip = RunService.Stepped:Connect(function()
            if char then
                for _, v in pairs(char:GetChildren()) do
                    if v:IsA("BasePart") then v.CanCollide = false end
                end
            end
        end)
        
        tween:Play()
        tween.Completed:Connect(function() if noclip then noclip:Disconnect() end end)
    end
end

-- ================= FUNGSI VISUAL NEON =================
local function AddHighlight(object, color, name)
    if not object:FindFirstChild("LusiNeon") then
        local hl = Instance.new("Highlight")
        hl.Name = "LusiNeon"
        hl.Parent = object
        hl.FillColor = color
        hl.OutlineColor = Color3.fromRGB(255, 255, 255)
        hl.FillTransparency = 0.4
        
        local bill = Instance.new("BillboardGui")
        bill.Name = "LusiName"
        bill.Parent = object
        bill.Adornee = object
        bill.Size = UDim2.new(0, 100, 0, 50)
        bill.StudsOffset = Vector3.new(0, 3, 0)
        bill.AlwaysOnTop = true
        
        local txt = Instance.new("TextLabel")
        txt.Parent = bill
        txt.BackgroundTransparency = 1
        txt.Size = UDim2.new(1, 0, 1, 0)
        txt.Text = name
        txt.TextColor3 = color
        txt.Font = Enum.Font.GothamBold
        txt.TextSize = 14
    end
end

local function ClearESP()
    for _, v in pairs(Workspace:GetDescendants()) do
        if v.Name == "LusiNeon" or v.Name == "LusiName" then v:Destroy() end
    end
end

-- ================= LOGIKA FARM & ATTACK (PENINGKATAN) =================
spawn(function()
    while task.wait() do -- Loop ultra cepat
        if getgenv().AutoFarm or getgenv().AutoRaid then
            pcall(function()
                -- 1. Equip Senjata Pilihan
                EquipWeapon(getgenv().SelectWeapon)

                -- 2. Cari Musuh
                local enemyFolder = Workspace:FindFirstChild("Enemies")
                if enemyFolder then
                    for _, enemy in pairs(enemyFolder:GetChildren()) do
                        if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 and enemy:FindFirstChild("HumanoidRootPart") then
                            
                            -- Loop Serangan ke Musuh Target
                            repeat task.wait()
                                if not getgenv().AutoFarm and not getgenv().AutoRaid then break end
                                
                                -- Teleport (Posisi di atas musuh 7 studs)
                                LocalPlayer.Character.HumanoidRootPart.CFrame = enemy.HumanoidRootPart.CFrame * CFrame.new(0, 7, 0)
                                
                                -- Auto Attack (Virtual User Click)
                                VirtualUser:CaptureController()
                                VirtualUser:ClickButton1(Vector2.new(800, 600))
                                
                                -- Tambahan: Buso Haki Otomatis (Jika belum aktif)
                                if not LocalPlayer.Character:FindFirstChild("HasBuso") then
                                    ReplicatedStorage.Remotes.CommF_:InvokeServer("Buso")
                                end
                                
                            until not enemy:Parent() or enemy.Humanoid.Health <= 0
                        end
                    end
                end
            end)
        end
    end
end)

-- ================= TAB 1: AUTO FARM (DENGAN WEAPON SELECT) =================
local TabFarm = Window:CreateTab("Auto Farm", 4483362458)

TabFarm:CreateSection("Konfigurasi Senjata")
TabFarm:CreateDropdown({
   Name = "Pilih Senjata (Select Weapon)",
   Options = {"Melee", "Sword", "Fruit", "Gun"},
   CurrentOption = "Melee",
   Callback = function(Option)
      getgenv().SelectWeapon = Option[1]
      Rayfield:Notify({Title = "Senjata Dipilih", Content = "Mode Farm: " .. Option[1], Duration = 2})
   end,
})

TabFarm:CreateSection("Mulai Farming")
TabFarm:CreateToggle({
   Name = "Auto Farm Nearest (Full Auto Attack)",
   CurrentValue = false,
   Callback = function(v) 
       getgenv().AutoFarm = v 
       if v then
           Rayfield:Notify({Title = "Farm Aktif", Content = "Menggunakan " .. getgenv().SelectWeapon, Duration = 2})
       end
   end
})

-- ================= TAB 2: SHOP (FIGHTING STYLES) =================
local TabShop = Window:CreateTab("Fighting Styles", 4483362458)
local function BuyStyle(styleName) ReplicatedStorage.Remotes.CommF_:InvokeServer(styleName) end

TabShop:CreateSection("--- SEA 1 ---")
TabShop:CreateButton({Name = "Beli Dark Step (150k)", Callback = function() BuyStyle("BuyBlackLeg") end})
TabShop:CreateButton({Name = "Beli Electro (500k)", Callback = function() BuyStyle("BuyElectro") end})
TabShop:CreateButton({Name = "Beli Water Kung Fu (750k)", Callback = function() BuyStyle("BuyFishmanKarate") end})

TabShop:CreateSection("--- SEA 2 ---")
TabShop:CreateButton({Name = "Beli Dragon Breath (1.5k Frag)", Callback = function() BuyStyle("BuyDragonBreath") end})
TabShop:CreateButton({Name = "Beli Superhuman (3M)", Callback = function() BuyStyle("BuySuperhuman") end})
TabShop:CreateButton({Name = "Beli Death Step", Callback = function() BuyStyle("BuyDeathStep") end})
TabShop:CreateButton({Name = "Beli Sharkman Karate", Callback = function() BuyStyle("BuySharkmanKarate") end})

TabShop:CreateSection("--- SEA 3 ---")
TabShop:CreateButton({Name = "Beli Electric Claw", Callback = function() BuyStyle("BuyElectricClaw") end})
TabShop:CreateButton({Name = "Beli Dragon Talon", Callback = function() BuyStyle("BuyDragonTalon") end})
TabShop:CreateButton({Name = "Beli Godhuman", Callback = function() BuyStyle("BuyGodhuman") end})

-- ================= TAB 3: AUTO RAID (V15) =================
local TabRaid = Window:CreateTab("Auto Raid", 4483362458)
TabRaid:CreateSection("Dungeon")
TabRaid:CreateButton({Name = "Beli Microchip (Flame)", Callback = function() ReplicatedStorage.Remotes.CommF_:InvokeServer("RaidsNpc", "Select", "Flame") task.wait(0.5) ReplicatedStorage.Remotes.CommF_:InvokeServer("RaidsNpc", "Buy") end})
TabRaid:CreateButton({Name = "Auto Start Raid", Callback = function() fireclickdetector(workspace.Map.RaidSummoner.Button.ClickDetector) end})
TabRaid:CreateToggle({Name = "Auto Kill Aura Dungeon", CurrentValue = false, Callback = function(v) getgenv().AutoRaid = v end})

-- ================= TAB 4: VISUAL ESP (V15) =================
local TabESP = Window:CreateTab("Visual ESP", 4483362458)
TabESP:CreateToggle({Name = "Neon Player ESP", CurrentValue = false, Callback = function(v) getgenv().PlayerESP = v if v then spawn(function() while getgenv().PlayerESP do for _, p in pairs(Players:GetPlayers()) do if p ~= LocalPlayer and p.Character then AddHighlight(p.Character, Color3.fromRGB(0, 255, 255), p.Name) end end task.wait(2) end end) else ClearESP() end end})
TabESP:CreateToggle({Name = "Neon Fruit ESP", CurrentValue = false, Callback = function(v) getgenv().FruitESP = v if v then spawn(function() while getgenv().FruitESP do for _, f in pairs(Workspace:GetChildren()) do if f:IsA("Tool") and (f.Name:find("Fruit") or f.Name:find("Blox")) then AddHighlight(f, Color3.fromRGB(255, 0, 255), f.Name) end end task.wait(2) end end) else ClearESP() end end})

-- ================= TAB 5: TELEPORT (V15) =================
local TabTP = Window:CreateTab("Teleportasi", 4483362458)
local S1_Data = { ["Starter Island"] = CFrame.new(1054, 16, 1547), ["Jungle"] = CFrame.new(-1448, 40, 1490), ["Pirate Village"] = CFrame.new(-1150, 40, 3900), ["Prison"] = CFrame.new(4870, 5, 735) }
local S1_List = {}; for n in pairs(S1_Data) do table.insert(S1_List, n) end
TabTP:CreateSection("Sea 1")
TabTP:CreateDropdown({Name = "Pilih Pulau Sea 1", Options = S1_List, Callback = function(o) SafeTween(S1_Data[o[1]]) end})

local S2_Data = { ["Kingdom of Rose"] = CFrame.new(-450, 72, 1100), ["Green Bit"] = CFrame.new(-2500, 72, -3000), ["Hot and Cold"] = CFrame.new(-5000, 72, -5000) }
local S2_List = {}; for n in pairs(S2_Data) do table.insert(S2_List, n) end
TabTP:CreateSection("Sea 2")
TabTP:CreateDropdown({Name = "Pilih Pulau Sea 2", Options = S2_List, Callback = function(o) SafeTween(S2_Data[o[1]]) end})

local S3_Data = { ["Port Town"] = CFrame.new(-290, 6, 5300), ["Hydra Island"] = CFrame.new(5200, 600, 300), ["Floating Turtle"] = CFrame.new(-13200, 500, -7500), ["Castle on the Sea"] = CFrame.new(-5000, 315, -3000) }
local S3_List = {}; for n in pairs(S3_Data) do table.insert(S3_List, n) end
TabTP:CreateSection("Sea 3")
TabTP:CreateDropdown({Name = "Pilih Pulau Sea 3", Options = S3_List, Callback = function(o) SafeTween(S3_Data[o[1]]) end})

Rayfield:Notify({Title = "V17 Weapon Master", Content = "Auto Equip & Auto Attack Siap!", Duration = 5})
